!function(o){"use strict";function e(o,e){var t=this;t.$element=o,t.element=o[0],t.isLoading=!1,t.init(e)}function t(e,t,n){o.ajax({type:"POST",url:e.url,data:e.data,timeout:e.timeout||1e4,success:t,error:n||function(o){alert(o)}})}var n,l=o(window),i=o(document);o.fn.xload=function(o){return new e(this,o)},e.prototype.init=function(e){var t=this;t.opts=o.extend(!1,{distance:50,needAutoLoad:!0,scrollArea:window,html_nomore:'<p class="x-nomore">没有更多数据</p>',html_loading:'<p class="x-loading">正在加载...</p>'},e),t.$nomore=o(t.opts.html_nomore),t.$loading=o(t.opts.html_loading),t.opts.scrollArea==window?(t.$scrollArea=l,t.scrollHeight=i.height(),t.clientHeight=document.documentElement.clientHeight):(t.$scrollArea=t.$element,t.scrollHeight=t.element.scrollHeight,t.clientHeight=t.element.clientHeight),l.on("resize",function(){}),t.autoLoad(),n=t.handleScroll.bind(t),t.$scrollArea.on("scroll",n)},e.prototype.autoLoad=function(){var o=this;o.opts.needAutoLoad&&o.scrollHeight-o.opts.distance<=o.clientHeight?o.handleLoad(o.autoLoad):o.opts.needAutoLoad=!1},e.prototype.handleScroll=function(){var o=this;!o.isLoading&&o.scrollHeight-o.opts.distance<=o.clientHeight+o.$scrollArea.scrollTop()&&(o.isLoading=!0,o.handleLoad())},e.prototype.handleLoad=function(o){var e=this;e.$element.append(e.$loading),t(e.opts.ajaxParams,function(t){e.isLoading=!1,e.$loading.remove(),e.opts.onAjaxSuccess(t,function(t){e.refreshScrollHeight(),"empty"===t.status||"nomore"===t.status?(e.$element.append(e.$nomore),e.remove()):(o&&o.call(e),"error"===t.status&&console.log("error"))})})},e.prototype.refreshScrollHeight=function(){var o=this;o.opts.scrollArea==window?o.scrollHeight=i.height():o.scrollHeight=o.element.scrollHeight},e.prototype.remove=function(){this.$scrollArea.off("scroll",n)}}(window.Zepto||window.jQuery);